"use strict";var PageServiceReceives=function(n){var t=this,u=n.url,i=n.model||{},o;i.serviceReceives=[];var e=new SimplePagination(".pagination-service-receives-list"),s=$.templates("#template-card-service-receives-empty"),h=$.templates("#template-card-service-receives-list"),c=$.templates("#template-card-service-receives-list-empty"),l=$.templates("#template-card-service-receives-list-response"),a=$.templates("#template-card-service-receives-list-response-empty"),r=$(".content-service-search"),f=r.find(".list-service-receives-list"),y=$(".content-service-receives-list-response"),v=(new Date).getTimezoneOffset()/-60;e.onPageChanged=function(n){t.loadServiceReceivesData(t.setServiceReceives,n)};t.loadServiceReceivesData=function(n,t){var r={keyword:""},f=10,s=t?t*f:0,e={filter:r.keyword,offset:s,recordSize:f,sorting:null,advancedFilter:r},o;i.search=e;o={url:u.getServiceReceives,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};$.ajax(o).done(n)};t.updateServiceSellerRead=function(n,t){if(n.providerIsRead)return!0;n.providerIsRead=!0;var i={url:u.updateServiceSellerRead.format(n),method:"PUT",headers:{"Content-Type":"application/json"},background:!0};$.ajax(i).done(t)};t.updateServiceSellerReadResponse=function(){};t.setServiceReceives=function(n){if(n&&n.status&&n.status.code===1)if(n.data.data.length>0){f.empty();e.set(n.data);$.each(n.data.data,function(n,t){t.tenureStart!==null&&(t.tenureStart=moment(t.tenureStart,"YYYY-MM-DDTHH:mm").add(0,"hour").format("DD MMM YYYY"));t.tenureEnd!==null&&(t.tenureEnd=moment(t.tenureEnd,"YYYY-MM-DDTHH:mm").add(0,"hour").format("DD MMM YYYY"));t.tenureStart!==null&&(t.startDate=moment(t.startDate,"YYYY-MM-DD").add(0,"hour").format("DD MMM YYYY"));t.createdOnUTC=moment(t.createdOnUTC,"YYYY-MM-DDTHH:mm").add(v,"hour").format("DD MMM YYYY")});r.bindText(n.data);var u=h.render(n.data.data);f.append(u);i.serviceReceives=i.serviceReceives.concat(n.data.data);i.selectedServiceReceives=n.data.data[0];t.showServiceReceiveDetails();r.find(".btn-decline").on("click",function(n){n.preventDefault();n.stopPropagation();swal({icon:"warning",title:"Are You Sure to Decline?",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-fail",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-success",closeModal:!0}}}).then(function(n){n&&t.declineService(t.responseDeclineService)})});r.find(".btn-accept").on("click",function(n){n.preventDefault();n.stopPropagation();swal({icon:"warning",title:"Are You Sure to Accept?",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-fail",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-success",closeModal:!0}}}).then(function(n){n&&t.acceptService(t.responseAcceptService)})})}else r.replaceWith(s),f.append(c),r.find(".content-service-receives-list-response").replaceWith(a);else swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.showServiceReceiveDetails=function(){var n,u;i.selectedServiceReceives&&(n=l.render(i.selectedServiceReceives),r.find(".content-service-receives-list-response").replaceWith(n),t.updateServiceSellerRead(i.selectedServiceReceives,t.updateServiceSellerReadResponse),u=$(".area-expertise"),i.selectedServiceReceives.serviceProfile.serviceExpertises.forEach(function(n){u.append("<span class='badge badge-pill badge-primary'>"+n.name+"<\/span>&nbsp;")}))};t.setServiceReceivesResponse=function(n){var r=$(n).data("entity-id"),u=$.grep(i.serviceReceives,function(n){return n.id===r});$(n).parent().children(".selected").removeClass("selected");$(n).addClass("selected");i.selectedServiceReceives=u[0];t.showServiceReceiveDetails()};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.acceptService=function(n){var t=i.selectedServiceReceives.id,r={id:t},f={url:u.acceptServiceApplication,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)};$.ajax(f).done(n)};t.responseAcceptService=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Service Request Accepted Succesfully"}).then(function(){location.reload()})})};t.declineService=function(n){var t=i.selectedServiceReceives.id,r={id:t},f={url:u.declineServiceApplication,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(r)};$.ajax(f).done(n)};t.responseDeclineService=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Repropose Request Declined Successfully"}).then(function(){location.reload()})})};t.setUserEvent=function(){f.on("click",".card-service-receives-list",function(){t.setServiceReceivesResponse(this);r.find(".btn-decline").on("click",function(n){n.preventDefault();n.stopPropagation();swal({icon:"warning",title:"Are You Sure to Decline?",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-fail",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-success",closeModal:!0}}}).then(function(n){n&&t.declineService(t.responseDeclineService)})});r.find(".btn-accept").on("click",function(n){n.preventDefault();n.stopPropagation();swal({icon:"warning",title:"Are You Sure to Accept?",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-fail",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-success",closeModal:!0}}}).then(function(n){n&&t.acceptService(t.responseAcceptService)})})})};t.getModel=function(){return i};o=function(){t.loadServiceReceivesData(t.setServiceReceives);t.setUserEvent()};o()},pageServiceReceives=new PageServiceReceives({url:{getServiceReceives:"/api/pro/serviceApplication/receives",acceptServiceApplication:"/api/pro/serviceApplication/accept",declineServiceApplication:"/api/pro/serviceApplication/decline",updateServiceSellerRead:"/api/pro/serviceApplication/{{id}}/seller/read"}});