"use strict";var PageServiceHires=function(n){var t=this,u=n.url,s=n.msg,i=n.model||{},l;i.serviceHires=[];i.productTypeId=41;i.selectedPayoutRequest=null;Object.defineProperty(t,"model",{get:function(){return i}});var h=new SimplePagination(".pagination-service-hires-list"),a=$.templates("#template-card-service-hires-list"),b=$.templates("#template-card-service-hires-list-empty"),v=$.templates("#template-card-service-hires-list-response"),y=$.templates("#template-card-service-hires-list-response-empty"),c=$("#form-service-hires"),r=$(".content-service-search"),f=$("[name='dateRangeFilter']"),e=r.find(".list-service-hires-list"),o=null,p=(new Date).getTimezoneOffset()/-60;h.onPageChanged=function(n){t.loadServiceHiresData(t.setServiceHires,n)};t.initDisplayComponent=function(){app.initFormComponent(c)};t.getDepositPayoutDetail=function(n){var t={url:u.getDepositPayoutDetail.format({id:i.selectedServiceHires.id}),method:"GET",headers:{"Content-Type":"application/json"}};$.ajax(t).done(n)};t.setDepositPayoutDetail=function(n){n&&n.status&&n.status.code===1?(n.data.totalRemaining=n.data.deposit.totalAmount-n.data.payout.totalAmount,n.data.deposit.nextDueDate!==null&&(n.data.deposit.formattedNextDueDate=moment.utc(n.data.deposit.nextDueDate).local().format("DD/MM/YYYY")),i.selectedServiceHires.depositPayout=n.data,t.showServiceHire(),t.loadDataTable()):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.updateServiceSellerRead=function(n,t){if(n.providerIsRead)return!0;n.providerIsRead=!0;var i={url:u.updateServiceSellerRead.format(n),method:"PUT",headers:{"Content-Type":"application/json"},background:!0};$.ajax(i).done(t)};t.updateServiceSellerReadResponse=function(){};t.loadServiceHiresData=function(n,t){var r={keyword:"",startDate:f.val()!==""?f.data("daterangepicker").startDate:null,endDate:f.val()!==""?f.data("daterangepicker").endDate:null},e=10,h=t?t*e:0,o={filter:r.keyword,offset:h,recordSize:e,sorting:null,advancedFilter:r},s;i.search=o;s={url:u.getServiceHires,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(o)};$.ajax(s).done(n)};t.setServiceHires=function(n){if(n&&n.status&&n.status.code===1)if(console.log(n),n.data.data.length>0){e.empty();h.set(n.data);$.each(n.data.data,function(n,t){t.tenureStart!==null&&(t.tenureStart=moment(t.tenureStart,"YYYY-MM-DDTHH:mm").format("DD MMM YYYY"));t.tenureEnd!==null&&(t.tenureEnd=moment(t.tenureEnd,"YYYY-MM-DDTHH:mm").format("DD MMM YYYY"));t.startDate&&(t.startDateText=moment(t.startDate,"YYYY-MM-DD").format("DD MMM YYYY"));t.endDate&&(t.endDateText=moment(t.endDate,"YYYY-MM-DD").format("DD MMM YYYY"));t.createdOnUTC=moment(t.createdOnUTC,"YYYY-MM-DDTHH:mm").add(p,"hour").format("DD MMM YYYY")});r.bindText(n.data);var u=a.render(n.data.data);e.append(u);i.serviceHires=i.serviceHires.concat(n.data.data);i.selectedServiceHires=n.data.data[0];t.showServiceHire();t.getDepositPayoutDetail(t.setDepositPayoutDetail);r.find(".card-list-info").removeClass("hidden")}else r.find(".card-list-info").addClass("hidden"),e.empty(),r.find(".content-service-hires-list-response").replaceWith(y);else swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.showServiceHire=function(){if(i.selectedServiceHires){t.updateServiceSellerRead(i.selectedServiceHires,t.updateServiceSellerReadResponse);var n=v.render(i.selectedServiceHires);r.find(".content-service-hires-list-response").replaceWith(n)}};t.setServiceHiresResponse=function(n){var r=$(n).data("entity-id"),u=$.grep(i.serviceHires,function(n){return n.id===r});$(n).parent().children(".selected").removeClass("selected");$(n).addClass("selected");i.selectedServiceHires=u[0];t.showServiceHire();t.getDepositPayoutDetail(t.setDepositPayoutDetail)};t.setUserEvent=function(){e.on("click",".card-service-hires-list:not(.selected)",function(){t.setServiceHiresResponse(this)});c.find(".submit").on("click",function(n){n.preventDefault();n.stopPropagation();t.loadServiceHiresData(t.setServiceHires)})};t.getModel=function(){return i};t.loadDataTable=function(){o&&o.destroy();o=r.find(".tbl-payout-request").DataTable({dom:'rt<"clear">',language:{searchPlaceholder:s.keywordSearch,lengthMenu:"_MENU_",info:s.info,search:"",emptyTable:"No Payout Request is created"},processing:!1,serverSide:!0,autoWidth:!0,scrollX:!0,columns:[{data:"createdDateTime"},{data:"payoutCycle"},{data:"formattedAmount"},{data:"statusName"},{data:"lastRemark"},{data:"action"}],ordering:!1,order:[[0,"asc"]],ajax:{url:u.getPayouRequests.format({id:i.selectedServiceHires.id}),type:"post",data:function(n){n.customFilter={}},dataFilter:function(n){var t=$.parseJSON(n),i=t.data.data,f=t.data.additionalData.allowedRaisePayout;return f&&r.find(".btn-new-payoutrequest").removeClass("hidden"),i.forEach(function(n){var f=u.getPayouRequest.replace(/{{id}}/g,n.id),e=n.status===-2?"Edit":"View",i,r,t;n.action='<input class="btn btn-primary w-auto" value="'+e+'" type="button"data-toggle="modal" data-target="#modal-payout-request"   data-keyboard="false" data-backdrop="static"              href="'+f+'" />                      ';n.status===2&&(i=u.getInvoiceStatement.replace(/{{id}}/g,n.invoiceId),n.action+='<br/><a class="text-primary" target="_blank"href="'+i+'">[Invoice]<\/a>',n.serviceChargeInvoiceId&&(r=u.getServiceChargeInvoiceStatement.replace(/{{id}}/g,n.serviceChargeInvoiceId),n.action+='<br/><a class="text-primary" target="_blank"href="'+r+'">[Escrow Invoice]<\/a>'));n.createdDateTime=moment.utc(n.createdOnUTC).local().format("DD/MM/YYYY");t=moment.utc(n.endDate).local();n.payoutCycle=t.format("YYYY MMM")+" #"+(t.toDate().getDate()<=15?1:2);n.formattedAmount=n.fee.toFixed(2)}),JSON.stringify(t.data)}},lengthMenu:[[10,25,50,-1],[10,25,50]]})};t.reloadSelectedEngagement=function(){t.getDepositPayoutDetail(t.setDepositPayoutDetail)};l=function(){t.initDisplayComponent();t.loadServiceHiresData(t.setServiceHires);t.setUserEvent()};l()},pageServiceHires=new PageServiceHires({url:{getServiceHires:"/api/pro/serviceApplication/hires",updateServiceSellerRead:"/api/pro/serviceApplication/{{id}}/seller/read",getPayouRequests:"/api/pro/payoutrequest/serviceapplication/{{id}}",getPayouRequest:"/pro/payoutrequest/{{id}}",getInvoiceStatement:"/pro/statement/Pdf/Invoice/{{id}}",getServiceChargeInvoiceStatement:"/pro/statement/Pdf/escrow/{{id}}",getDepositPayoutDetail:"/api/pro/serviceApplication/{{id}}/depositPayout"},msg:{keywordSearch:"search by keyword",info:"this is info"}});