"use strict";var PageConsultationList=function(n){function v(n){n.on("click",".btn-search-candidates",function(t){var r;if(t.preventDefault(),t.stopPropagation(),n.valid()===!1)return!1;r=app.getFormValue(n);console.log(i.selectedConsultation);var f=u.searchConsultationCondidates.format(i.selectedConsultation),e={category:i.selectedConsultation.categoryId,yearExperience:i.selectedConsultation.yearExperience},o=$.param(e);location.href=f+"?"+o})}var t=this,u=n.url,i=n.model||{},s,h;i.consultationList=[];var e=new SimplePagination(".pagination-consultation-list-list"),c=$.templates("#template-card-consultation-empty"),l=$.templates("#template-card-consultation-list"),a=$.templates("#template-card-consultation-detail"),r=$(".content-consultation-search"),f=r.find(".list-consultation-list"),o=$("#form-search-candidates");e.onPageChanged=function(n){t.loadConsultationListData(t.setConsultationList,n)};s=function(){var n=window.location.getUrlQueryParams();n&&n.created==="1"&&$(".content-consultation-job-created").removeClass("hidden")};t.loadConsultationListData=function(n,t){var r={keyword:""},f=10,s=t?t*f:0,e={filter:r.keyword,offset:s,recordSize:f,sorting:null,advancedFilter:r},o;i.search=e;o={url:u.getConsultationList,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};$.ajax(o).done(n)};t.deleteConsultationProfile=function(n){var t={url:u.deleteConsultationList.format(i.selectedConsultation),method:"DELETE",headers:{"Content-Type":"application/json"}};$.ajax(t).done(n)};t.setConsultationList=function(n){if(n&&n.status&&n.status.code===1)if(n.data.data.length>0){$.each(n.data.data,function(n,t){t.createdOnUTC=moment(t.createdOnUTC,"YYYY-MM-DDTHH:mm").format("DD MMM YYYY")});console.log(n);r.bindText(n.data);f.empty();e.set(n.data);var u=l.render(n.data.data);f.append(u);i.consultationList=i.consultationList.concat(n.data.data);i.selectedConsultation=n.data.data[0];t.refreshConsultationDetail(i.selectedConsultation)}else r.replaceWith(c);else f.empty(),e.set(n.data),swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setConsultationListResponse=function(n){var r=$(n).data("entity-id"),u=$.grep(i.consultationList,function(n){return n.id===r});$(n).parent().children(".selected").removeClass("selected");$(n).addClass("selected");i.selectedConsultation=u[0];t.refreshConsultationDetail(i.selectedConsultation)};t.refreshConsultationDetail=function(n){if(r.find(".content-consultation-detail").empty(),n){o.removeClass("hidden");n.timeSlots.forEach(function(n){n.startDateText=moment(n.startDate,"YYYY-MM-DDTHH:mm").format("dddd");n.startTimeText=moment(n.startDate,"YYYY-MM-DDTHH:mm").format("hh:mm A");n.endTimeText=moment(n.endDate,"YYYY-MM-DDTHH:mm").format("hh:mm A")});n.timeSlots=n.timeSlots?n.timeSlots.sort(function(n,t){return n.startDate<t.startDate?-1:n.startDate>t.startDate?1:0}):[];var t=a.render(n);r.find(".content-consultation-detail").replaceWith(t);app.initFormComponent(r.find("#form-search-candidates"));v(r.find("#form-search-candidates"))}else o.addClass("hidden"),r.find(".content-consultation-detail").empty()};t.onConsultationProfileDeleted=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Consultation Request Deleted Succesfully "}).then(function(){location.reload()})})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setUserEvent=function(){f.on("click",".card-consultation-list",function(){t.setConsultationListResponse(this);r.find(".content-consultation-detail").on("click",".btn-edit",function(){location.href=u.getConsultationCandidateList.format(i.selectedConsultation)})});r.on("click",".btn-delete",function(){swal({icon:"warning",title:"Are You Sure to Delete?",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-secondary",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-primary",closeModal:!0}}}).then(function(n){n&&t.deleteConsultationProfile(t.onConsultationProfileDeleted)})})};h=function(){s();t.loadConsultationListData(t.setConsultationList);t.setUserEvent()};h()},pageConsultationList=new PageConsultationList({url:{getConsultationList:"/api/pro/consultation/list",deleteConsultationList:"/api/pro/consultation/{{id}}",searchConsultationCondidates:"/pro/consultation/{{id}}/candidates"}});