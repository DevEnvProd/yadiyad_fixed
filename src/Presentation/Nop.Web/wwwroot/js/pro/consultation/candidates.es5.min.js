"use strict";var PageConsultationCandidates=function(n){var t=this,s=".content-consultation-candidates",r=n.url,u=new SimplePagination,i,f,e,o;u.onPageChanged=function(n){t.getConsultationProfileCandidates(t.setConsultationProfileCandidates,n)};i=n.model||{consultationProfile:{},candidateResult:{totalCount:0,data:[],selected:!1},pagination:u,searchCandidates:function(){t.getConsultationProfileCandidates(t.setConsultationProfileCandidates)},setCandidateResult:function(n){return u.set(n),$.observable(this.candidateResult).setProperty(n),!1},setCandidateSelected:function(n){return $.observable(this.candidateResult).setProperty("selected",n),!1},inviteCandidates:function(n){var i=[],r;n?i.push(n.id):(r=$.grep(this.candidateResult.data,function(n){return n.selected}),i=$.map(r,function(n){return n.id}));t.inviteCandidates(i,t.inviteCandidatesResponse)},setCandidatePastJob:function(n,t){var i=$.grep(this.candidateResult.data,function(t){return t.id===n.id});return i.length===1&&$.observable(i[0]).setProperty("pastJobs",t),!1},showMoreCandidateDetail:function(n,i){if($(n.target).is('[name="invited"]'))return!0;$.observable(i.view.data).setProperty("showMore",i.view.data.showMore!==!0);i.view.data.pastJobs||t.getConsultantPastJob(i.view.data,0,t.setConsultantPastJob)}};Object.defineProperty(t,"model",{get:function(){return i}});$.templates({tmplConsultationCandidates:"#tmpl-consultation-candidates"});f=function(){var t=window.location.href,n=t.split("/");i.id=parseInt(n[n.length-2])||0};t.getConsultationProfileCandidates=function(n,t){var u=window.location.getUrlQueryParams(),f=10,e=t?t*f:0,o={offset:e,recordSize:f,filter:{keyword:""}.keyword,advancedFilter:{yearExperience:u.yearexperience,categoryIds:[u.category],expertiseIds:u.expertises}},s={url:r.searchConsultationCondidates.format(i),method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(o)};i.id!==0?$.ajax(s).done(n):n(null)};t.inviteCandidates=function(n,t){var u={url:r.inviteConsultationCondidates.format(i),method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(n)};$.ajax(u).done(t)};t.getConsultantPastJob=function(n,t,i){var u={offset:t,recordSize:10,sorting:null,advancedFilter:{}},f={url:r.getConsultantPastJob.format(n),method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(u)};$.ajax(f).done(function(r){i(r,n,t)})};t.setConsultationProfileCandidates=function(n){t.handleResponse(n,function(n){i.setCandidateResult(n.data)})};t.inviteCandidatesResponse=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Consultation Invitation is sent to Candidate",buttons:{confirm:"Back to search results"}}).then(function(){i.searchCandidates()})})};t.setConsultantPastJob=function(n,r){t.handleResponse(n,function(n){i.setCandidatePastJob(r,n.data)})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};e=function(){};o=function(){e();f();$.templates.tmplConsultationCandidates.link(s,i);i.searchCandidates();$.observable(i).observeAll(function(){var n=i.candidateResult.data.filter(function(n){return n.selected}).length!==0;i.setCandidateSelected(n);console.log(n)})};o()},pageConsultationCandidates=new PageConsultationCandidates({url:{searchConsultationCondidates:"/api/pro/consultation/{{id}}/candidates",inviteConsultationCondidates:"/api/pro/consultation/{{id}}/invite",getConsultantPastJob:"/api/pro/service/{{id}}/consultation/reviewed"}});