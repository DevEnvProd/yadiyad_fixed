"use strict";var PageConsultationList=function(n){var t=this,e=n.url,i=n.model||{},s;i.consultationList=[];var p=(new Date).getTimezoneOffset()/-60,o=new SimplePagination(".pagination-consultation-facilitating-list"),h=$.templates("#template-card-consultation-list"),c=$.templates("#template-card-consultation-list-empty"),l=$.templates("#template-card-consultation-detail"),a=$.templates("#template-card-consultation-detail-empty"),r=$(".content-consultation-search"),v=$(".consultation-approval"),u=r.find(".list-consultation-list"),f=v.find("#form-consultation-profile-complete"),y=r.find("#form-consultation-profile-filter");o.onPageChanged=function(n){t.loadConsultationListData(t.setConsultationList,n)};Object.defineProperty(t,"model",{get:function(){return i}});t.loadConsultationListData=function(n,t){var r={keyword:""},u=10,s=t?t*u:0,f={filter:r.keyword,offset:s,recordSize:u,sorting:null,advancedFilter:r},o;r.date=$("#inputFaciFilterDate").val();r.statusId=$("#selectFaciFilterStatus").val();r.name=$("#inputOrganizationName").val();i.search=f;o={url:e.getConsultationList,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(f)};$.ajax(o).done(n)};t.setConsultationList=function(n){if(n&&n.status&&n.status.code===1)if(n.data.data.length>0){r.bindText(n.data);$("#divFaciBtnShow").show();n.data.data.forEach(function(n){n.consultantAvailableTimeSlots=n.consultantAvailableTimeSlots?n.consultantAvailableTimeSlots.sort(function(n,t){return n.startDate<t.startDate?-1:n.startDate>t.startDate?1:0}):[];n.appointmentDateText=moment(n.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("DD MMM YYYY");n.appointmentStartTimeText=moment(n.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("h:mma");n.appointmentEndTimeText=moment(n.appointmentEndDate,"YYYY-MM-DDTHH:mm").format("h:mma")});var f=h.render(n.data.data);u.empty();o.set(n.data);u.append(f);i.consultationList=i.consultationList.concat(n.data.data);i.selectedConsultation=n.data.data[0];t.refreshConsultationDetail(i.selectedConsultation)}else u.empty(),o.set(n.data),u.append(c),r.find(".content-consultation-detail").replaceWith(a),$("#divFaciBtnShow").hide();else swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setConsultationListResponse=function(n){var f=$(n).data("entity-id"),e=$.grep(i.consultationList,function(n){return n.id===f}),r,u;$(n).parent().children(".selected").removeClass("selected");$(n).addClass("selected");i.selectedConsultation=e[0];r=i.selectedConsultation.statusRemarks;u=i.selectedConsultation.consultationApplicationStatus;$("#inputFaciRemarks").val(r);$("#selectCompleteEnum").val(u);t.refreshConsultationDetail(i.selectedConsultation)};t.refreshConsultationDetail=function(n){n.consultantAvailableTimeSlots=n.consultantAvailableTimeSlots?n.consultantAvailableTimeSlots.sort(function(n,t){return n.startDate<t.startDate?-1:n.startDate>t.startDate?1:0}):[];n.consultantAvailableTimeSlots.forEach(function(n){n.startDateText=moment(n.startDate,"YYYY-MM-DDTHH:mm").add(0,"hour").format("ddd");n.startTimeText=moment(n.startDate,"YYYY-MM-DDTHH:mm").add(0,"hour").format("h:mma");n.endTimeText=moment(n.endDate,"YYYY-MM-DDTHH:mm").add(0,"hour").format("h:mma")});n.appointmentDateText=moment(n.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("DD MMM YYYY");n.appointmentStartTimeText=moment(n.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("h:mma");n.appointmentEndTimeText=moment(n.appointmentEndDate,"YYYY-MM-DDTHH:mm").format("h:mma");var t=l.render(n);r.find(".content-consultation-detail").replaceWith(t)};t.onConsultationProfileDeleted=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Selected Consultation Profile Deleted",text:"Delete sucessfully"}).then(function(){location.reload()})})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setUserEvent=function(){u.on("click",".card-consultation-list",function(){t.setConsultationListResponse(this);r.find(".content-consultation-detail").on("click",".btn-edit",function(){location.href=e.getConsultationCandidateList.format(i.selectedConsultation)})});f.find("button[type=submit]").on("click",function(n){n.preventDefault();n.stopPropagation();t.validationForm()&&t.createConsultationFacilitating(t.onSubmitConsultationFacilitatingResponse)});$("#btnFaciSearch").on("click",function(){t.loadConsultationListData(t.setConsultationList)});$("dropdown-menu").on("change",function(){var n=$("#dropdownMenuButton").val();alert(n)})};t.createConsultationFacilitating=function(n){var t=app.getFormValue(f),r;t.completionStatus=parseInt($("#selectCompleteEnum").val());r={url:f.attr("action").format(i)+"/"+i.selectedConsultation.id,method:f.attr("method"),headers:{"Content-Type":"application/json"},data:JSON.stringify(t)};$.ajax(r).done(n)};t.validationForm=function(){return f.valid()&&!0};t.onSubmitConsultationFacilitatingResponse=function(n){n&&n.status&&n.status.code===1?swal({icon:"success",title:"Approval Consultation Invitation",text:"Update sucessfully"}).then(function(){location.href=e.getReturnUrl}):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};s=function(){t.loadConsultationListData(t.setConsultationList);t.setUserEvent();app.initFormComponent(y)};s()},pageConsultationList=new PageConsultationList({url:{getConsultationList:"/api/pro/ConsultationInvitation/facilitating/list",getReturnUrl:"/pro/consultation/facilitating"}});