"use strict";var PagePayJobEscrow=function(n){var t=this,u=n.url,r=n.model||{},f;r.selectedPaymentOptionId=null;var e=$.templates("#template-payjobescrow"),o=$.templates("#template-payment"),h=$.templates("#template-payment-gateway"),i=$(".content-payjobescrow"),s=$(".content-payment-gateway");t.loadPaymentOptions=function(n){var t={url:u.getPaymentOptions,method:"GET",headers:{"Content-Type":"application/json"}};$.ajax(t).done(n)};t.generatePaymentLink=function(n){var t={url:u.generatePaymentLink,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({id:r.orderId})};$.ajax(t).done(n)};t.createOrder=function(n){var t,i,f;typeof pageJobApplicant!="undefined"&&(t=pageJobApplicant&&pageJobApplicant.model,t!==null&&(r.selectedServiceProfile=t&&t.selectedJobEngagement));i={productTypeId:5,refId:r.selectedServiceProfile.id};f={url:u.createOrder,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(i)};$.ajax(f).done(n)};t.createOrderResponse=function(n){var t,u,f;r.orderId=n.data.id;t=0;u=$.grep(n.data.orderItems,function(n){return n.price<0});$.each(n.data.orderItems,function(n,i){i.price>0&&(t+=i.price)});n.data.offsetableOrderItems=u;n.data.payableAmount=t;f=e.render(n.data);i.append(f);app.initFormComponent(i)};t.paymentService=function(n){var t=r.orderId,i={url:u.updateOrder.format({id:t}),method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({orderStatusId:30,paymentStatusId:30})};$.ajax(i).done(n)};t.responsePaymentService=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Escrow payment has been paid"}).then(function(){location.reload()})})};t.setPaymentOptions=function(n){t.handleResponse(n,function(n){var t=o.render({paymentMethods:n.data});i.empty();i.append(t)})};t.redirectToPaymentGateway=function(n){t.handleResponse(n,function(n){s.empty();window.location.href=n.data.paymentURL})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setSelectedPaymentOption=function(n){var t=$(n),u=t.data("id");r.selectedPaymentOptionId=u;i.find(".btn-payment-option").removeClass("border-primary");i.find(".btn-payment-option").addClass("border-white");t.removeClass("border-white");t.addClass("border-primary");i.find(".btn-confirm-pay").removeAttr("disabled")};t.setUserEvent=function(){i.on("click",".btn-pay",function(){t.generatePaymentLink(t.redirectToPaymentGateway)});i.on("click",".btn-payment-option",function(){t.setSelectedPaymentOption(this)});i.on("click",".btn-confirm-pay",function(){t.generatePaymentLink(t.redirectToPaymentGateway)})};f=function(){t.createOrder(t.createOrderResponse);t.setUserEvent()};f()},pagePayJobEscrow=new PagePayJobEscrow({url:{createOrder:"/api/pro/order/0",updateOrder:"/api/pro/order/{{id}}",getPaymentOptions:"/api/pro/payment/option",generatePaymentLink:"/api/pro/payment"}});