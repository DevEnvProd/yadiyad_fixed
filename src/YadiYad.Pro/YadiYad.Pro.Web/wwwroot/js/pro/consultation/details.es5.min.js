"use strict";var PageConsultationProfileDetails=function(n){var t=this,u=n.model,h=n.url,r=$(".content-consultation-profile"),i=r.find("#form-consultation-profile"),l=r.find(".area-agreement"),a=r.find(".btn-cancel"),s=null,f=null,o=new Date,e,c;o.setYear(1990);o.setMonth(0);o.setDate(1);o.setHours(0,0,0,0);e=new Date;e.setYear(1990);e.setMonth(0);e.setDate(7);e.setHours(23,59,59,99);t.initDisplayComponent=function(){app.initFormComponent(i);f=new WeeklyScheduler("#calendar",null,null,null,{hourStart:7,hourEnd:22});f.setEnabledDateRange("week",o,e);f.onChanged=function(){var n=Object.keys(f.Calendar._controller.schedules.items).length;r.find('[name="schedule"]').val(n||"");r.find('[name="schedule"]').valid()};s=new SimpleForm({selector:"#content-form-design",model:null});app.setFormValue(i,{timeZoneId:1,timeZoneName:"Malaysia (GMT + 8)"})};Object.defineProperty(t,"weeklyScheduler",{get:function(){return f}});Object.defineProperty(t,"simpleForm",{get:function(){return s}});t.getConsultationProfileData=function(n){var t={url:h.getConsultationProfile.format(u),method:"get",headers:{"Content-Type":"application/json"}};u.id!==0?(r.find(".lbl-page-title").text("Update Consultation Request"),$.ajax(t).done(n)):(r.find(".lbl-page-title").text("Create Consultation Request"),n(null))};t.createConsultationProfile=function(n){var r=app.getFormValue(i),f;r.id||(r.id=0);r.questions=s.model.fields;r.timeslots=t.getScheduleCollection();f={url:i.attr("action").format(u),method:i.attr("method"),headers:{"Content-Type":"application/json"},data:JSON.stringify(r)};$.ajax(f).done(n)};t.setData=function(n){u=n.model||{};h=n.url;var i=window.location.href,t=i.split("/");u.id=parseInt(t[t.length-1])||0;u.id!==0?l.addClass("hidden"):a.addClass("hidden")};t.setConsultationProfileData=function(n){var t,e,o,u;n&&n.status&&n.status.code===1&&(t=n.data,app.setFormValue(i,t),e=$('select[name="segmentId"]').select2("data"),e.length&&(e[0].code=t.segmentId),o=$('select[name="timeZoneId"]').select2("data"),o.length&&(o[0].code=t.timeZoneId),s.setFields(t.questions),u=[],t.timeSlots.forEach(function(n){var t={start:moment(n.startDate,"YYYY-MM-DDTHH:mm").toDate(),end:moment(n.endDate,"YYYY-MM-DDTHH:mm").toDate()};u.push(t)}),f.setSchedule(u),r.find('[name="schedule"]').val(u.length||""))};t.getScheduleCollection=function(){var n=[];return $.each(f.Calendar._controller.schedules.items,function(t,i){var r={startDate:moment(i.start.toDate()).format("YYYY-MM-DD HH:mm"),endDate:moment(i.end.toDate()).format("YYYY-MM-DD HH:mm")};n.push(r)}),n};t.validationForm=function(){return i.valid()&&!0};t.onSubmitConsultationProfileResponse=function(n){n&&n.status&&n.status.code===1?swal({icon:"success",title:u.id===0?"Consultation Profile Created Successfully":"Consultation Profile Updated Successfully"}).then(function(){location.href=h.getConsultationProfileListPage}):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setUserEvent=function(){i.find("button[type=submit]").on("click",function(n){n.preventDefault();n.stopPropagation();t.validationForm()&&t.createConsultationProfile(t.onSubmitConsultationProfileResponse)});i.find('[type="number"]').off("change.decimal").on("change.decimal",function(){this.value&&this.value.indexOf(".")>-1&&(this.value=parseFloat(this.value).toFixed(1))})};c=function(){t.initDisplayComponent();t.setData(n);t.getConsultationProfileData(t.setConsultationProfileData);t.setUserEvent()};c()},pageConsultationProfileDetails=new PageConsultationProfileDetails({url:{getConsultationProfile:"/api/pro/consultation/{{id}}",getConsultationProfilePage:"/pro/consultation/{{id}}",getConsultationProfileListPage:"/pro/consultation/list"}});