"use strict";var PageConfirmedConsultationOrder=function(n){var t=this,s=".content-consultation-candidates",e=$(s),i=n.url,u=n.msg,a=(new Date).getTimezoneOffset()/-60,o=new SimplePagination,f=null,v=null,y=null,r,h,c,l;o.onPageChanged=function(n){t.getConsultationInvitationList(t.setConsultationInvitationList,n)};r=n.model||{serviceChargeRate:.75,selectedConsultationInvitation:null,applicants:{totalCount:0,data:[],selected:!1},pagination:o,setCandidateResult:function(n){return o.set(n),n&&n.data&&$.each(n.data,function(n,t){t.createdOnText=moment(t.createdOnUTC,"YYYY-MM-DDTHH:mm").add(a,"hour").format("DD MMM YYYY");t.appointmentStartDate&&t.appointmentEndDate?(t.appointmentDateText=moment(t.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("YYYY-MM-DD (ddd)"),t.appointmentStartTimeText=moment(t.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("h:mmA"),t.appointmentEndTimeText=moment(t.appointmentEndDate,"YYYY-MM-DDTHH:mm").format("h:mmA")):$.each(t.consultantAvailableTimeSlots,function(n,t){t.startDateText=moment(t.startDate,"YYYY-MM-DDTHH:mm").format("dddd");t.startTimeText=moment(t.startDate,"YYYY-MM-DDTHH:mm").format("hh:mm A");t.endTimeText=moment(t.endDate,"YYYY-MM-DDTHH:mm").format("hh:mm A")})}),$.observable(this.applicants).setProperty({totalCount:0,data:[],selected:!1}),$.observable(this.applicants).setProperty(n),this.applicants.data&&this.applicants.data.length>0&&this.selectApplicant(this.applicants.data[0]),!1},showApplicantDetail:function(){return $.observable(this.selectedConsultationInvitation).setProperty("showMore",!0),!1},showReviewForm:function(){var n=this;return $.observable(this.selectedConsultationInvitation).setProperty("isReviewFormShown",!0),$("input.rating[type=number], div.rating").each(function(){$(this).rating({iconLib:"",inactiveIcon:"far fa-star",activeIcon:"fa fa-star",additionalClasses:"cursor-pointer"}).on("change",function(){var t=$(this).attr("name"),i=$(this).val();$.observable(n.selectedConsultationInvitation).setProperty(t,i)})}),!1},publishReview:function(){var n={reviewText:this.selectedConsultationInvitation.reviewText,knowledgenessRating:this.selectedConsultationInvitation.knowledgenessRating,relevanceRating:this.selectedConsultationInvitation.relevanceRating,respondingRating:this.selectedConsultationInvitation.respondingRating,clearnessRating:this.selectedConsultationInvitation.clearnessRating,professionalismRating:this.selectedConsultationInvitation.professionalismRating};return t.reviewConsultationInvitation(this.selectedConsultationInvitation.id,n,t.reviewConsultationInvitationResponse),!1},selectApplicant:function(n){var r=$.grep(this.applicants.data,function(n){return n.selected===!0}),i;r.length===1&&$.observable(r[0]).setProperty("selected",!1);i=$.grep(this.applicants.data,function(t){return t.id===n.id});i.length===1&&($.observable(i[0]).setProperty("selected",!0),$.observable(this).setProperty("selectedConsultationInvitation",null),$.observable(this).setProperty("selectedConsultationInvitation",i[0]),t.updateOrganizationConsultationInvitationRead(i[0]));f=null;t.loadRefundRequestTable();t.loadDepositRequestTable();t.loadPayoutRequestTable();$("input.rating[type=number], div.rating").each(function(){$(this).rating({iconLib:"",inactiveIcon:"far fa-star",activeIcon:"fa fa-star"})});$(".submit-refund").on("click",function(n){n.preventDefault();n.stopPropagation();swal({icon:"warning",title:"Are You Sure to Create Refund Request?",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-secondary",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-primary",closeModal:!0}}}).then(function(n){n&&t.consultationRefund(t.onConsultationRefunded)})});return!1},stopSelectApplicantRefund:function(){$.observable(this.selectedConsultationInvitation).setProperty("canRefund",!1)}};Object.defineProperty(t,"model",{get:function(){return r}});$.templates({tmplConsultationJobApplicant:"#tmpl-consultation-job-applicant"});h=function(){};t.getConsultationInvitationList=function(n,t){var r=10,u=t?t*r:0,f={offset:u,recordSize:r,filter:{keyword:""}.keyword,advancedFilter:{consultationInvitationStatuses:[4,5,6,7,8,9,10]}},e={url:i.getConsultationInvitationList,method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(f)};$.ajax(e).done(n)};t.reviewConsultationInvitation=function(n,t,r){var u={url:i.reviewConsultationInvitation.format({id:n}),method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(t)};$.ajax(u).done(r)};t.consultationRefund=function(n){var t={url:i.submitRefund.format({id:r.selectedConsultationInvitation.id}),method:"POST",headers:{"Content-Type":"application/json"}};$.ajax(t).done(n)};t.updateOrganizationConsultationInvitationRead=function(n){if(n.isOrganizationRead!==!0){var t={url:i.updateOrganizationConsultationInvitationRead.format({id:n.id}),background:!0,method:"PUT",headers:{"Content-Type":"application/json"}};$.ajax(t).done(function(n){console.log(n)})}};t.setConsultationInvitationList=function(n){t.handleResponse(n,function(n){r.setCandidateResult(n.data)})};t.reviewConsultationInvitationResponse=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Review Submitted Successfully"}).then(function(){t.getConsultationInvitationList(t.setConsultationInvitationList)})})};t.onConsultationRefunded=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Refund Request Created Successfully"}).then(function(){t.loadRefundRequestTable()})})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.loadPayoutRequestTable=function(){y=e.find(".tbl-payout-request").DataTable({dom:'rt<"clear">',language:{searchPlaceholder:u.keywordSearch,lengthMenu:"_MENU_",info:u.info,search:"",emptyTable:"No Payout Request is created"},processing:!1,serverSide:!0,autoWidth:!0,scrollX:!0,columns:[{data:"createdDateTime"},{data:"formattedAmount"},{data:"statusName"},{data:"lastRemark"},{data:"lastRemark"}],ordering:!1,order:[[0,"asc"]],ajax:{url:i.getPayouRequests.format({id:r.selectedConsultationInvitation.id}),type:"post",data:function(n){n.customFilter={}},dataFilter:function(n){var t=$.parseJSON(n),r=t.data.data;return r.forEach(function(n){var f=i.getPayouRequest.replace(/{{id}}/g,n.id),u,t,r;n.action='<input class="btn btn-primary w-auto" value="View" type="button"data-toggle="modal" data-target="#modal-payout-request"   data-keyboard="false" data-backdrop="static"              href="'+f+'" />                      ';n.status===2&&(u=i.getInvoiceStatement.replace(/{{id}}/g,n.invoiceId),n.action+='<a class="text-primary" target="_blank"href="'+u+'">[Invoice]<\/a>                      ');n.createdDateTime=moment.utc(n.createdOnUTC).local().format("DD/MM/YYYY");t=moment.utc(n.endDate).local();n.payoutCycle=t.format("YYYY MMM")+" #"+(t.toDate().getDate()<=15?1:2);n.formattedAmount=n.fee.toFixed(2);n.remarks&&n.remarks.length&&(r=n.remarks[n.remarks.length-1],n.lastRemark=r.actorName+": "+r.remark)}),JSON.stringify(t.data)}},lengthMenu:[[10,25,50,-1],[10,25,50]]})};t.loadDepositRequestTable=function(){var n=e.find(".tbl-deposit-request");if(n&&n.length){v=n.DataTable({dom:'rt<"clear">',language:{searchPlaceholder:u.keywordSearch,lengthMenu:"_MENU_",info:u.info,search:"",emptyTable:"No Deposit Request is created"},processing:!1,serverSide:!0,autoWidth:!0,scrollX:!0,columns:[{data:"formattedRequestDate"},{data:"formattedDueDate"},{data:"formattedAmount"},{data:"statusText"},{data:"action"}],ordering:!1,order:[[0,"asc"]],ajax:{url:i.getDepositRequests.format({id:r.selectedConsultationInvitation.id}),type:"post",data:function(n){n.customFilter={}},dataFilter:function(n){var t=$.parseJSON(n),r=t.data.data;return r.forEach(function(n){var t,r,u;n.status===1?(t=i.getDepositRequestStatement.replace(/{{id}}/g,n.id),n.action='<a class="text-primary" target="_blank"href="'+t+'"><i class="fas fa-file-alt"><\/i> Statement<\/a>                      ',n.serviceChargeInvoiceId&&(r=i.getInvoiceStatement.replace(/{{id}}/g,n.serviceChargeInvoiceId),n.action+='<a class="text-primary" target="_blank"href="'+r+'">[Invoice]<\/a>')):(u=i.payDepositRequest,n.action='<input class="btn btn-primary w-auto btn-pay-deposit-request" value="Pay" type="button"data-toggle="modal" data-target="#modal-job-application-pay"   data-keyboard="false" data-backdrop="static"              data-id="'+n.id+'"        href="'+u+'" />                      ');n.formattedRequestDate=moment.utc(n.requestDate).local().format("DD/MM/YYYY");n.formattedDueDate=moment.utc(n.dueDate).local().format("DD/MM/YYYY");n.formattedAmount=n.amount.toFixed(2)}),JSON.stringify(t.data)}},lengthMenu:[[10,25,50,-1],[10,25,50]]});n.on("click",".btn-pay-deposit-request",function(){var n=$(this),t=n.data("id");r.depositRequestId=t})}};t.loadRefundRequestTable=function(){var n=e.find(".tbl-refund-request");if(n&&n.length){if(f){f.ajax.reload();return}f=n.DataTable({dom:'rt<"clear">',language:{searchPlaceholder:u.keywordSearch,lengthMenu:"_MENU_",info:u.info,search:"",emptyTable:"No Refund Request is created"},processing:!1,serverSide:!0,autoWidth:!0,scrollX:!0,columns:[{data:"createdDateTime"},{data:"refundNumber"},{data:"formattedAmount"},{data:"formattedServiceCharge"},{data:"statusName"},{data:"action"}],ordering:!1,order:[[0,"asc"]],ajax:{url:i.getRefundRequests.format({id:r.selectedConsultationInvitation.id}),type:"post",data:function(n){n.customFilter={}},dataFilter:function(n){var t=$.parseJSON(n),u=t.data.data;return u.forEach(function(n){if(n.action="",n.status===1){var t=i.getRefundStatement.replace(/{{id}}/g,n.id);n.action+='<a class="text-primary" target="_blank"href="'+t+'">[Refund]<\/a>                      '}n.createdDateTime=moment.utc(n.createdOnUTC).local().format("DD/MM/YYYY");n.formattedAmount="RM "+n.amount.toFixed(2);n.formattedServiceCharge="RM "+n.serviceCharge.toFixed(2)}),u.length>0&&r.stopSelectApplicantRefund(),JSON.stringify(t.data)}},lengthMenu:[[10,25,50,-1],[10,25,50]]})}};c=function(){};l=function(){c();h();$.templates.tmplConsultationJobApplicant.link(s,r);t.getConsultationInvitationList(t.setConsultationInvitationList)};l()},pageConfirmedConsultationOrder=new PageConfirmedConsultationOrder({url:{getConsultationInvitationList:"/api/pro/consultationinvitation/organization/list",reviewConsultationInvitation:"/api/pro/consultationinvitation/{{id}}/review",getRefundStatement:"/pro/statement/Pdf/Refund/{{id}}",getRefundRequests:"/api/pro/refundrequest/consultationinvitation/{{id}}",submitRefund:"/api/pro/consultationinvitation/{{id}}/refund",getPayouRequest:"/pro/payoutrequest/{{id}}",getPayouRequests:"/api/pro/payoutrequest/consultationinvitation/{{id}}",getDepositRequests:"/api/pro/depositrequest/consultationinvitation/{{id}}",getDepositRequestStatement:"/pro/statement/Pdf/Deposit/{{id}}",getInvoiceStatement:"/pro/statement/Pdf/Invoice/{{id}}",updateOrganizationConsultationInvitationRead:"/api/pro/consultationinvitation/{{id}}/org/read"},msg:{keywordSearch:"search by keyword",info:"this is info"}});