"use strict";var PageConsultationList=function(n){var t=this,u=n.url,i=n.model||{},s;i.consultationList=[];var y=(new Date).getTimezoneOffset()/-60,o=new SimplePagination(".pagination-consultation-replyreview-list"),h=$.templates("#template-card-consultation-list"),c=$.templates("#template-card-consultation-detail"),l=$.templates("#template-card-consultation-list-empty"),a=$.templates("#template-card-consultation-detail-empty"),f=$(".content-consultation-search"),e=f.find(".list-consultation-list"),v=$(".consultation-approval"),r=v.find("#form-consultation-invitation-approval");o.onPageChanged=function(n){t.loadConsultationListData(t.setConsultationList,n)};t.loadConsultationListData=function(n,t){var r={keyword:""},f=10,s=t?t*f:0,e={filter:r.keyword,offset:s,recordSize:f,sorting:null,advancedFilter:r},o;i.search=e;o={url:u.getConsultationList,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};$.ajax(o).done(n)};t.setConsultationList=function(n){if(n&&n.status&&n.status.code===1)if(n.data.data.length>0){f.bindText(n.data);var r=h.render(n.data.data);e.empty();o.set(n.data);e.append(r);i.consultationList=i.consultationList.concat(n.data.data);t.refreshConsultationDetail(n.data.data[0])}else e.append(l),f.find(".content-consultation-detail").replaceWith(a),$("#divReplyBtnShow").hide();else swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setConsultationListResponse=function(n){var r=$(n).data("entity-id"),u=$.grep(i.consultationList,function(n){return n.id===r});$(n).parent().children(".selected").removeClass("selected");$(n).addClass("selected");t.refreshConsultationDetail(u[0])};t.refreshConsultationDetail=function(n){if(i.selectedConsultation&&i.selectedConsultation.id===n.id)return!1;app.clearForm(r);i.selectedConsultation=n;n.consultantAvailableTimeSlots=n.consultantAvailableTimeSlots?n.consultantAvailableTimeSlots.sort(function(n,t){return n.startDate<t.startDate?-1:n.startDate>t.startDate?1:0}):[];n.consultantAvailableTimeSlots.forEach(function(n){n.startDateText=moment(n.startDate,"YYYY-MM-DDTHH:mm").add(0,"hour").format("(ddd)");n.startTimeText=moment(n.startDate,"YYYY-MM-DDTHH:mm").add(0,"hour").format("h:mma");n.endTimeText=moment(n.endDate,"YYYY-MM-DDTHH:mm").add(0,"hour").format("h:mma")});var t=c.render(n);f.find(".content-consultation-detail").replaceWith(t)};t.setUserEvent=function(){e.on("click",".card-consultation-list",function(){t.setConsultationListResponse(this);f.find(".content-consultation-detail").on("click",".btn-edit",function(){location.href=u.getConsultationCandidateList.format(i.selectedConsultation)})});$('[name="isApproved"]').on("change",function(){var n=$(this).val();switch(n){case"true":$(".grp-remark").addClass("hidden");break;case"false":$(".grp-remark").removeClass("hidden")}});r.find("button[type=submit]").on("click",function(n){n.preventDefault();n.stopPropagation();t.validationForm()&&t.createConsultationInvitationApproval(t.onSubmitConsultationInvitationApprovalResponse)})};t.createConsultationInvitationApproval=function(n){var t=app.getFormValue(r),u;t.id=i.selectedConsultation.id;u={url:r.attr("action").format(i)+"/"+i.selectedConsultation.id,method:r.attr("method"),headers:{"Content-Type":"application/json"},data:JSON.stringify(t)};$.ajax(u).done(n)};t.validationForm=function(){return r.valid()&&!0};t.onSubmitConsultationInvitationApprovalResponse=function(n){n&&n.status&&n.status.code===1&&n.data===!0?swal({icon:"success",title:"Consultation Request is Approved"}).then(function(){location.href=u.getReturnUrl}):n&&n.status&&n.status.code===1&&n.data===!1?swal({icon:"success",title:"Consultation Request is Rejected, requires Updates"}).then(function(){location.href=u.getReturnUrl}):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){location.href=u.getReturnUrl})};s=function(){app.initFormComponent(r);t.loadConsultationListData(t.setConsultationList);t.setUserEvent()};s()},pageConsultationList=new PageConsultationList({url:{getConsultationList:"/api/pro/ConsultationInvitation/checking/list",getReturnUrl:"/pro/consultation/reply/review"}});