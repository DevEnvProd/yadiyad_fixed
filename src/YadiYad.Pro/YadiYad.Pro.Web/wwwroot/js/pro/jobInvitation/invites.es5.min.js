"use strict";var PageJobInvites=function(n){var e=(new Date).getTimezoneOffset()/-60,t=this,u=n.url,o=".content-job-invites",s=$(".content-job-invites"),h=$.templates("#template-card-job-invites-empty"),r,i,f;$.templates({tmplContentJobInvite:"#tmpl-content-job-invites"});Object.defineProperty(t,"model",{get:function(){return i}});r=new SimplePagination;r.onPageChanged=function(n){t.loadJobInviteData(t.setJobInvitesList,n)};i=n.model||{jobInvitesList:{totalCount:0,data:[]},pagination:r,selectedJobInvite:[],setJobInvitesResult:function(n){return r.set(n),$.each(n.data,function(n,t){t.createdOn=moment(t.createdOnUTC,"YYYY-MM-DDTHH:mm").add(e,"hour").format("DD MMM YYYY");t.jobProfile&&(t.jobProfile.startDateText=moment(t.jobProfile.startDate,"YYYY-MM-DD").add(0,"hour").format("DD MMM YYYY"));t.consultationProfile&&(t.ratePerSession=100,t.consultationProfile.timeSlots.forEach(function(n){var i=moment(n.startDate,"YYYY-MM-DDTHH:mm"),r=moment(n.endDate,"YYYY-MM-DDTHH:mm");n.startDateText=i.format("dddd");n.startTimeText=i.format("hh:mm A");n.endTimeText=r.format("hh:mm A");n.start=i.toDate();n.end=r.toDate();n.isReadOnly=!0;n.selected=t.consultantAvailableTimeSlots.filter(function(t){return t.startDate===n.startDate&&t.endDate===n.endDate}).length>0}),t.consultationProfile.timeSlots=t.consultationProfile.timeSlots.sort(function(n,t){return n.start>t.start?1:n.start<t.start?-1:0}))}),$.observable(this.jobInvitesList).setProperty("data",n.data),$.observable(this.jobInvitesList).setProperty("totalCount",n.totalCount),this.jobInvitesList.data&&this.jobInvitesList.data.length>0?this.setSelectedJobInvite(this.jobInvitesList.data[0]):s.replaceWith(h),!1},setSelectedJobInvite:function(n){var i=this,t;console.log(n);t=$.grep(this.jobInvitesList.data,function(n){return n.selected===!0});t.length>0&&($.observable(t[0]).setProperty("showQuestionnaire",!1),$.observable(t[0]).setProperty("selected",!1));$.observable(this).setProperty("selectedJobInvite",null);$.observable(this).setProperty("selectedJobInvite",n);$.observable(n).setProperty("selected",!0);n.consultantAvailableTimeSlots&&n.consultantAvailableTimeSlots.length?$.observable(i.selectedJobInvite).setProperty("selectedTimeSlot",n.consultantAvailableTimeSlots):$.observable(i.selectedJobInvite).setProperty("selectedTimeSlot",[]);n.isApproved===!1&&this.replyJobInvite(2)},replyJobInvite:function(n){this.selectedJobInvite.jobProfile?swal({icon:"warning",title:n===2?"Are You Sure to Accept?":"Are You Sure to Decline?",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-fail",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-success",closeModal:!0}}}).then(function(i){i&&t.replyJobInvite(n,t.responseJobInviteUpdates)}):this.selectedJobInvite.consultationProfile&&this.selectedJobInvite.showQuestionnaire!==!0?($.observable(this.selectedJobInvite).setProperty("showQuestionnaire",!0),app.initFormComponent($(".form-job-invitation"))):this.selectedJobInvite.consultationProfile&&this.selectedJobInvite.showQuestionnaire===!0&&$(".form-job-invitation").valid()&&(this.selectedJobInvite.consultantAvailableTimeSlots=[].concat(this.selectedJobInvite.selectedTimeSlot),t.replyConsultationInvite(this.selectedJobInvite,t.responseJobInviteUpdates))},selectConsultationTimeSlot:function(n){var t=$.grep(this.selectedJobInvite.selectedTimeSlot,function(t){return JSON.stringify({start:t.startDate,end:t.endDate}).toLowerCase()===JSON.stringify({start:n.startDate,end:n.endDate}).toLowerCase()}).length===0;t?this.selectedJobInvite.selectedTimeSlot.push(n):this.selectedJobInvite.selectedTimeSlot=$.grep(this.selectedJobInvite.selectedTimeSlot,function(t){return JSON.stringify({start:t.startDate,end:t.endDate}).toLowerCase()!==JSON.stringify({start:n.startDate,end:n.endDate}).toLowerCase()})}};t.loadJobInviteData=function(n,t){var r={keyword:""},f=10,s=t?t*f:0,e={filter:r.keyword,offset:s,recordSize:f,sorting:null,advancedFilter:r},o;i.search=e;o={url:u.getJobInvites,method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};$.ajax(o).done(n)};t.replyJobInvite=function(n,t){var r=i.selectedJobInvite.id,f={jobInvitationStatus:n},e={url:u.replyJobInvite.format({id:r}),method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(f)};$.ajax(e).done(t)};t.refresh=function(){t.loadJobInviteData(t.setJobInvitesList)};t.replyConsultationInvite=function(n,t){var i={questionnaireAnswer:n.consultantReplys,consultantAvailableTimeSlots:n.consultantAvailableTimeSlots,ratesPerSession:n.ratesPerSession,consultationApplicationStatus:2},r={},f;$.each(n.consultantReplys,function(n,t){r[t.name]=t.answers});i.questionnaireAnswer=JSON.stringify(r);f={url:u.replyConsultationInvite.format({id:n.id}),method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(i)};$.ajax(f).done(t)};t.setJobInvitesList=function(n){t.handleResponse(n,function(n){i.setJobInvitesResult(n.data)})};t.responseJobInviteUpdates=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Pending for Organization's Review",buttons:{confirm:"OK"}}).then(function(){t.loadJobInviteData(t.setJobInvitesList);componentSeekerCounter&&componentSeekerCounter.refresh()})})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.getModel=function(){return i};f=function(){$.templates.tmplContentJobInvite.link(o,i);t.loadJobInviteData(t.setJobInvitesList)};f()},pageJobInvites=new PageJobInvites({url:{getJobInvites:"/api/pro/jobinvitation/invites",replyJobInvite:"/api/pro/jobinvitation/{{id}}",replyConsultationInvite:"/api/pro/consultationinvitation/{{id}}"}});