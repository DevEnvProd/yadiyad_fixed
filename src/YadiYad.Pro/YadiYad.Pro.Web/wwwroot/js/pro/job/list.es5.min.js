"use strict";var PageJobList=function(n){var i=this,u=n.url,t=n.model||{},s;t.jobList=[];var e=new SimplePagination(".pagination-job-list-list"),h=$.templates("#template-card-job-empty"),c=$.templates("#template-card-job-list"),l=$.templates("#template-card-job-list-empty"),a=$.templates("#template-card-job-list-response"),v=$.templates("#template-card-job-list-response-empty"),r=$(".content-job-search"),f=r.find(".list-job-list"),o=(new Date).getTimezoneOffset()/-60;e.onPageChanged=function(n){i.loadJobListData(i.setJobList,n)};i.loadJobListData=function(n,i){var r={keyword:""},f=10,s=i?i*f:0,e={filter:r.keyword,offset:s,recordSize:f,sorting:null,advancedFilter:r},o;t.search=e;o={url:u.getJobList,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};$.ajax(o).done(n)};i.submitJobProfile=function(n){swal({title:"Are You Sure to Delete?",icon:"warning",buttons:["No","Yes"],dangerMode:!0}).then(function(i){if(i){t.selectedJobList.deleted=!0;var r={url:u.updateJobProfile.format(t.selectedJobList),method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(t.selectedJobList)};$.ajax(r).done(n)}else swal("Failed to delete Job profile!")})};i.onSubmitJobProfileResponse=function(n){n&&n.status&&n.status.code===1?swal({icon:"success",title:"Delete Job Profile",text:"Delete sucessfully"}).then(function(){location.reload()}):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};i.publishJobProfile=function(n){swal({icon:"warning",title:"Are you sure to publish the job ads?",text:"- Important: Once Jobs are published, no changes would be allowed",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-secondary",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-primary",closeModal:!0}}}).then(function(i){if(i){t.selectedJobList.status=1;var r={url:u.updateJobProfile.format(t.selectedJobList),method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(t.selectedJobList)};$.ajax(r).done(n)}})};i.onPublishJobProfileResponse=function(n){n&&n.status&&n.status.code===1?swal({icon:"success",title:"Job Profile Published Successfully"}).then(function(){i.loadJobListData(i.setJobList,e.model.pageIndex)}):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};i.setJobList=function(n){if(n&&n.status&&n.status.code===1)if(n.data.data.length>0){n.data.data.forEach(function(n){n.startDate!==null&&(n.startDate=moment(n.startDate,"YYYY-MM-DDTHH:mm").add(o,"hour").format("DD MMM YYYY"));n.viewJobCandidateFullProfileSubscriptionEndDate!==null&&(n.expiredAtDate=moment(n.viewJobCandidateFullProfileSubscriptionEndDate,"YYYY-MM-DDTHH:mm").add(o,"hour").format("DD MMM YYYY"));n.payAmount!==null&&(n.payAmount=parseFloat(n.payAmount).toFixed(2))});r.bindText(n.data);f.empty();e.set(n.data);var u=c.render(n.data.data);f.append(u);t.jobList=t.jobList.concat(n.data.data);t.selectedJobList=n.data.data[0];t.selectedJobList.stateProvinceId||(t.selectedJobList.stateProvinceName="All State");t.selectedJobList.cityId||(t.selectedJobList.cityName="All City");i.setJobListResponse(f.find(".card")[0])}else r.replaceWith(h),f.empty(),e.set(n.data),f.append(l),r.find(".content-job-list-response").replaceWith(v);else swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};i.setJobListResponse=function(n){var s=$(n).data("entity-id"),f=$.grep(t.jobList,function(n){return n.id===s}),e,o;$(n).parent().children(".selected").removeClass("selected");$(n).addClass("selected");$(n).parent().find(".action-panel").removeClass("selected");$(n).find(".action-panel").addClass("selected");t.selectedJobList=f[0];t.selectedJobList.stateProvinceId||(t.selectedJobList.stateProvinceName="All State");t.selectedJobList.cityId||(t.selectedJobList.cityName="All City");t.selectedJobApplicationId=f[0].id;e=a.render(t.selectedJobList);r.find(".content-job-list-response").replaceWith(e);o=$(".area-expertise");t.selectedJobList.requiredExpertises.forEach(function(n){o.append("<span class='badge badge-pill badge-primary'>"+n.name+"<\/span>&nbsp;")});r.find(".content-job-list-response").on("click",".btn-edit",function(){location.href=u.editJobProfilePage.format(t.selectedJobList)});r.find(".content-job-list-response").on("click",".btn-search",function(){location.href=u.searchCandidatePage.format(t.selectedJobList)});r.find(".content-job-list-response").on("click",".btn-publish",function(){i.publishJobProfile(i.onPublishJobProfileResponse)})};i.setUserEvent=function(){f.on("click",".card-job-list",function(){i.setJobListResponse(this);r.find(".card-job-list").on("click",".btn-edit",function(){location.href=u.editJobProfilePage.format(t.selectedJobList)});r.find(".card-job-list").on("click",".btn-delete",function(){i.submitJobProfile(i.onSubmitJobProfileResponse)});r.find(".card-job-list").on("click",".btn-publish",function(){i.publishJobProfile(i.onPublishJobProfileResponse)})})};i.getModel=function(){return t};s=function(){i.loadJobListData(i.setJobList);i.setUserEvent()};s()},pageJobList=new PageJobList({url:{getJobList:"/api/pro/job",editJobProfilePage:"/pro/job/details/{{id}}",searchCandidatePage:"/pro/job/{{id}}/candidate",updateJobProfile:"/api/pro/job/profile/{{id}}"}});