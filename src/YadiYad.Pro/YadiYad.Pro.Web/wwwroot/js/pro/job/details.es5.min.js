"use strict";var PageJobProfileDetails=function(n){var t=this,u=n.model,e=n.url,l=!0,r=$(".content-job-profile"),i=r.find("#form-job-profile"),k=r.find(".area-agreement"),d=r.find(".btn-cancel"),g=r.find(".partial-header"),nt=r.find(".title-create"),tt=r.find(".title-update"),a=r.find(".form-group-freelancing"),v=r.find(".form-group-parttime"),y=r.find(".form-group-projectbased"),o=r.find(".form-group-timeframe"),p=r.find(".form-group-location"),f=r.find(".form-group-paymentphase"),s=r.find(".form-group-schedule"),w=r.find(".form-group-milestone"),it=r.find(".btn-add-milestone"),h=r.find(".section-milestone"),c=r.find('[name="jobRequired"]'),b='<div class="section-inner-milestone card card-body"><div class="form-group row"><label for="" class="col-sm-3 col-form-label">Description<\/label><div class="col-sm-9"><input type="text" class="form-control" name="description{{id}}" required maxlength="200"/><\/div><\/div><div class="form-group row"><label for="" class="col-sm-3 col-form-label">Amount<\/label><div class="col-sm-9 "><div class="input-group"><div class="input-group-prepend"><span class="input-group-text">RM<\/span><\/div><input type="number" class="form-control text-right milestoneAmount" required name="amount{{id}}" placeholder="0.00" min="1" max="1000000"><\/div><\/div><\/div><div class="form-group"><div class="float-right"><button type="button" class="btn btn-default btn-remove-milestone" onclick="this.offsetParent.remove();">Remove<\/button><\/div><\/div><\/div>';t.initDisplayComponent=function(){app.initFormComponent(i);app.setFormValue(i,{countryId:131,countryName:"Malaysia"})};t.setData=function(n){u=n.model||{};e=n.url;var i=window.location.href,t=i.split("/");u.id=parseInt(t[t.length-1])||0;u.id!==0?(k.addClass("hidden"),nt.addClass("hidden"),g.addClass("hidden")):(d.addClass("hidden"),tt.addClass("hidden"))};t.getJobProfileData=function(n){var t={url:e.getJobProfile.format(u),method:"get",headers:{"Content-Type":"application/json"}};u.id!==0?$.ajax(t).done(n):n(null)};t.setJobProfileData=function(n){var r,u,e,s;n&&n.status&&n.status.code===1&&(app.setFormValue(i,n.data),r=$('select[name="categoryId"]').select2("data"),r.length&&(r[0].code=n.data.categoryId),u=$('select[name="cityId"]').select2("data"),u.length&&(u[0].code=n.data.cityId),e=$('select[name="stateProvinceId"]').select2("data"),e.length&&(e[0].code=n.data.stateProvinceId),s=$('select[name="countryId"]').select2("data"),s.length&&(s[0].code=n.data.countryId),n.data.jobMilestones.forEach(function(n,t){var i=b.replaceAll("{{id}}",t);h.last().append(i)}),$(".section-inner-milestone").each(function(t){var i=n.data.jobMilestones[t].description,r=n.data.jobMilestones[t].amount;$(this).find('[name^="description"]').val(i);$(this).find('[name^="amount"]').val(r)}),$(".milestoneAmount").change(function(){t.recalculateMilestoneTotalAmount()}),$(".btn-remove-milestone").click(function(){t.recalculateMilestoneTotalAmount();$(".section-inner-milestone").each(function(n){n<1?$(".btn-remove-milestone").addClass("hidden"):$(".btn-remove-milestone").removeClass("hidden")})}),i.find('[name="jobType"]:checked').trigger("change",!0),i.find('[name="isImmediate"]:checked').trigger("change",!0),i.find('[name="isOnsite"]:checked').trigger("change",!0),i.find('[name="isPartialOnsite"]:checked').trigger("change",!0),o.removeClass("hidden"),f.removeClass("hidden"),l=!1)};t.submitJobProfile=function(n){var f=$('[name="isOnsite"]').is(":checked"),e=$('[name="isPartialOnsite"]').is(":checked"),o=$('[name="isRemote"]').is(":checked"),t,r;f||e||o?(t=app.getFormValue(i),t.id||(t.id=0),t.jobMilestones=[],t.jobType==="3"&&$(".section-inner-milestone").each(function(n){var i={};i.sequence=n;i.description=$(this).find('[name^="description"]').val();i.amount=$(this).find('[name^="amount"]').val();i.description!==null&&i.amount!==null&&t.jobMilestones.push(i)}),t.jobType==="4"&&t.jobMilestones.length===0?swal({icon:"warning",title:"Fail",text:"Milestone is required for project-based service profile."}).then(function(){}):(r={url:i.attr("action").format(u),method:i.attr("method"),headers:{"Content-Type":"application/json"},data:JSON.stringify(t)},$.ajax(r).done(n))):swal({icon:"warning",title:"Fail",text:"Please select job model"}).then(function(){})};t.validationForm=function(){return i.valid()&&!0};t.onSubmitJobProfileResponse=function(n){n&&n.status&&n.status.code===1?swal({icon:"success",title:u.id===0?"Job Profile Created Successfully":"Job Profile Updated Successfully"}).then(function(){location.href=e.getJobProfileListPage}):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setUserEvent=function(){i.find(".btn-submit").on("click",function(n){if(n.preventDefault(),n.stopPropagation(),t.validationForm()){var i=$(this).is(".btn-publish");i?($('[name="status"]').val(1),swal({icon:"warning",title:"Are you sure to publish the job ad? ",text:"- Important: Once Jobs are published, no changes would be allowed",buttons:{cancel:{text:"Cancel",value:!1,visible:!0,className:"btn-secondary",closeModal:!0},confirm:{text:"Confirm",value:!0,visible:!0,className:"btn-primary",closeModal:!0}}}).then(function(n){n&&t.submitJobProfile(t.onSubmitJobProfileResponse)})):($('[name="status"]').val(0),t.submitJobProfile(t.onSubmitJobProfileResponse))}});i.find(".btn-cancel").on("click",function(n){n.preventDefault();n.stopPropagation();location.href=e.getJobProfileListPage});i.find('[name="jobType"]').on("change",function(){var n=$(".section-inner-milestone").length,i=$(this).val();f.addClass("hidden");y.addClass("hidden");a.addClass("hidden");v.addClass("hidden");w.addClass("hidden");$('[name="payAmount"]').attr("disabled",!1);l||$('[name="payAmount"]').val(0);switch(i){case"1":f.removeClass("hidden");a.removeClass("hidden");o.removeClass("hidden");s.removeClass("hidden");c.attr("max",40);app.clearForm(h);break;case"2":f.removeClass("hidden");v.removeClass("hidden");o.removeClass("hidden");s.removeClass("hidden");c.attr("max",31);break;case"3":f.removeClass("hidden");y.removeClass("hidden");o.removeClass("hidden");w.removeClass("hidden");s.addClass("hidden");$('[name="payAmount"]').attr("disabled",!0);t.recalculateMilestoneTotalAmount();c.attr("max",120);n<1&&t.showMilestone();app.clearForm(s)}});i.find('[name="isImmediate"]').on("change",function(){var n=$(this).is(":checked");switch(n){case!1:$('[name="startDate"]').prop("required",!0);$('[name="startDate"]').prop("disabled",!1);break;case!0:$('[name="startDate"]').val(null);$('[name="startDate"]').removeAttr("required");$('[name="startDate"]').prop("disabled",!0)}});i.find('[name="isOnsite"],[name="isPartialOnsite"],[name="isRemote"]').on("change",function(){var n=$('[name="isOnsite"]').is(":checked"),t=$('[name="isPartialOnsite"]').is(":checked"),i=$('[name="isRemote"]').is(":checked");n||t?p.removeClass("hidden"):p.addClass("hidden")});it.on("click",function(n){n.preventDefault();n.stopPropagation();t.showMilestone()});i.find('[name="payAmount"]').on("change",function(){var n=$(this).val();n!==null&&n!==""&&$(this).val(parseFloat(this.value).toFixed(2))})};t.showMilestone=function(){var n=$(".section-inner-milestone").length,r=b.replaceAll("{{id}}",n);h.last().append(r);n<1?$(".btn-remove-milestone").addClass("hidden"):$(".btn-remove-milestone").removeClass("hidden");$(".milestoneAmount").change(function(){t.recalculateMilestoneTotalAmount()});$(".btn-remove-milestone").click(function(){t.recalculateMilestoneTotalAmount();$(".section-inner-milestone").each(function(n){n<1?$(".btn-remove-milestone").addClass("hidden"):$(".btn-remove-milestone").removeClass("hidden")})});app.initFormComponent(i)};t.recalculateMilestoneTotalAmount=function(){var n=0;$(".section-inner-milestone").each(function(){var t=$(this).find('[name^="amount"]').val();t!==null&&(n+=parseFloat(t))});$("[name='payAmount']").val(n)};t.initDisplayComponent();t.setData(n);t.setUserEvent();t.getJobProfileData(t.setJobProfileData)},pageJobProfileDetails=new PageJobProfileDetails({url:{getJobProfile:"/api/pro/job/{{id}}",getJobProfilePage:"/pro/job/{{id}}",getJobProfileListPage:"/pro/job/list"}});