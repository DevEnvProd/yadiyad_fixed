"use strict";var PageJobApplications=function(n){var c=(new Date).getTimezoneOffset()/-60,t=this,i=n.url,o=n.msg,l=".content-job-application",s=$("#form-job-list"),u=$(".content-job-application"),e=null,f,r,h;$.templates({tmplContentJobApplication:"#tmpl-content-job-application"});Object.defineProperty(t,"model",{get:function(){return r}});f=new SimplePagination;f.onPageChanged=function(n){t.loadJobApplicationData(t.setJobApplicationsList,n)};r=n.model||{productTypeId:5,jobApplicationsList:{totalCount:0,data:[]},pagination:f,selectedJobApplication:null,setJobApplicationsResult:function(n){return f.set(n),console.log(n),$.each(n.data,function(n,t){if(t.createdOn=moment(t.createdOnUTC,"YYYY-MM-DDTHH:mm").add(c,"hour").format("DD MMM YYYY"),t.jobProfile&&(t.jobProfile.startDateText=moment(t.jobProfile.startDate,"YYYY-MM-DD").add(0,"hour").format("DD MMM YYYY"),t.startDate!==null&&(t.startDateText=moment(t.startDate,"YYYY-MM-DD").format("DD MMM YYYY")),t.endDate!==null&&(t.endDateText=moment(t.endDate,"YYYY-MM-DD").format("DD MMM YYYY")),t.jobType===3&&t.jobMilestones.length>0&&(t.startMilestoneText=t.jobMilestones[0].description,t.endMilestoneId!==null))){var i=t.jobMilestones.filter(function(n){return n.id===t.endMilestoneId});t.endMilestoneText=i[0].description}t.consultationProfile&&(t.appointmentStartDate&&t.appointmentEndDate?(t.appointmentDateText=moment(t.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("YYYY-MM-DD (ddd)"),t.appointmentStartText=moment(t.appointmentStartDate,"YYYY-MM-DDTHH:mm").format("h:mmA"),t.appointmentEndText=moment(t.appointmentEndDate,"YYYY-MM-DDTHH:mm").format("h:mmA")):t.consultantAvailableTimeSlots&&t.consultantAvailableTimeSlots.forEach(function(n){n.startDateText=moment(n.startDate,"YYYY-MM-DDTHH:mm").format("dddd");n.startTimeText=moment(n.startDate,"YYYY-MM-DDTHH:mm").format("hh:mmA");n.endTimeText=moment(n.endDate,"YYYY-MM-DDTHH:mm").format("hh:mmA");n.start=moment(n.startDate,"YYYY-MM-DDTHH:mm").toDate();n.end=moment(n.endDate,"YYYY-MM-DDTHH:mm").toDate();n.isReadOnly=!0}))}),$.observable(this.jobApplicationsList).setProperty("data",n.data),$.observable(this.jobApplicationsList).setProperty("totalCount",n.totalCount),this.jobApplicationsList.data&&this.jobApplicationsList.data.length>0&&this.setSelectedJobApplication(this.jobApplicationsList.data[0]),!1},setSelectedJobApplication:function(n){var i=$.grep(this.jobApplicationsList.data,function(n){return n.selected===!0});i.length>0&&$.observable(i[0]).setProperty("selected",!1);$.observable(this).setProperty("selectedJobApplication",null);$.observable(this).setProperty("selectedJobApplication",n);$.observable(n).setProperty("selected",!0);n.jobProfile&&(t.updateJobSeekerRead(n,t.updateJobSeekerReadResponse),t.getDepositPayoutDetail(t.setDepositPayoutDetail),t.loadDataTable());n.consultationProfile&&(t.updateConsultantRead(n,t.updateConsultantReadResponse),t.loadDataTable())}};t.initDisplayComponent=function(){app.initFormComponent(s)};t.loadJobApplicationData=function(n,t){var f={keyword:""},e=u.find('[name="dateRangeFilter"]'),o=e.data("daterangepicker"),c;e.length&&e.val()&&(f.startDate=o.startDate,f.endDate=o.endDate);var s=10,l=t?t*s:0,h={filter:f.keyword,offset:l,recordSize:s,sorting:null,advancedFilter:f};r.search=h;c={url:i.getJobApplications,method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(h)};$.ajax(c).done(n)};t.updateJobSeekerRead=function(n,t){if(n.isRead)return!0;n.isRead=!0;var r={url:i.updateJobSeekerApplicationRead.format(n),method:"PUT",headers:{"Content-Type":"application/json"},background:!0};$.ajax(r).done(t)};t.updateConsultantRead=function(n,t){if(n.isRead)return!0;n.isRead=!0;var r={url:i.updateConsultantRead.format(n),method:"PUT",headers:{"Content-Type":"application/json"},background:!0};$.ajax(r).done(t)};t.getDepositPayoutDetail=function(n){var t={url:i.getDepositPayoutDetail.format({id:r.selectedJobApplication.id}),method:"GET",headers:{"Content-Type":"application/json"}};$.ajax(t).done(n)};t.setDepositPayoutDetail=function(n){t.handleResponse(n,function(n){n.data.totalRemaining=n.data.deposit.totalAmount-n.data.payout.totalAmount;n.data.deposit.nextDueDate!==null&&(n.data.deposit.formattedNextDueDate=moment.utc(n.data.deposit.nextDueDate).local().format("DD/MM/YYYY"));$.observable(r.selectedJobApplication).setProperty("depositPayout",n.data)})};t.setJobApplicationsList=function(n){t.handleResponse(n,function(n){r.setJobApplicationsResult(n.data)})};t.updateJobSeekerReadResponse=function(n){t.handleResponse(n,function(){componentSeekerCounter&&componentSeekerCounter.refresh()})};t.updateConsultantReadResponse=function(n){t.handleResponse(n,function(){componentSeekerCounter&&componentSeekerCounter.refresh()})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.loadDataTable=function(){e&&e.destroy();e=u.find(".tbl-payout-request").DataTable({dom:'rt<"clear">',language:{searchPlaceholder:o.keywordSearch,lengthMenu:"_MENU_",info:o.info,search:"",emptyTable:"No Payout Request is created"},processing:!1,serverSide:!0,autoWidth:!0,scrollX:!0,columns:[{data:"createdDateTime"},{data:"payoutCycle"},{data:"formattedAmount"},{data:"statusName"},{data:"lastRemark"},{data:"action"}],ordering:!1,order:[[0,"asc"]],ajax:{url:(r.selectedJobApplication.consultationProfile?i.getConsultationPayouRequests:i.getPayouRequests).format({id:r.selectedJobApplication.id}),type:"post",data:function(n){n.customFilter={}},dataFilter:function(n){var t=$.parseJSON(n),r=t.data.data,f=t.data.additionalData.allowedRaisePayout;return f?u.find(".btn-new-payoutrequest").removeClass("hidden"):u.find(".btn-new-payoutrequest").addClass("hidden"),r.forEach(function(n){var e=i.getPayouRequest.replace(/{{id}}/g,n.id),o=n.status===-2?"Edit":"View",u,f,t,r;n.action=n.endDate||n.jobMilestonePhase?'<input class="btn btn-primary w-auto d-inline-block" value="'+o+'" type="button"data-toggle="modal" data-target="#modal-payout-request"   data-keyboard="false" data-backdrop="static"              href="'+e+'" />                      ':"";n.status===2&&(u=i.getPayoutInvoiceStatement.replace(/{{id}}/g,n.invoiceId),n.action+=n.action?"<br/>":"",n.action+='<a class="text-primary" target="_blank"href="'+u+'">[Invoice]<\/a>                      ',n.serviceChargeInvoiceId&&(f=i.getServiceChargeInvoiceStatement.replace(/{{id}}/g,n.serviceChargeInvoiceId),n.action+='<br/><a class="text-primary" target="_blank"href="'+f+'">[Escrow Invoice]<\/a>'));n.createdDateTime=moment.utc(n.createdOnUTC).local().format("DD/MM/YYYY");n.endDate?(t=moment.utc(n.endDate).local(),n.payoutCycle=t.format("YYYY MMM")+" #"+(t.toDate().getDate()<=15?1:2)):n.payoutCycle=n.jobMilestonePhase?"Phase "+n.jobMilestonePhase+" - "+n.jobMilestoneName:"";n.formattedAmount=n.fee.toFixed(2);n.remarks&&n.remarks.length&&(r=n.remarks[n.remarks.length-1],n.lastRemark=r.actorName+": "+r.remark)}),JSON.stringify(t.data)}},lengthMenu:[[10,25,50,-1],[10,25,50]]})};t.reloadSelectedEngagement=function(){t.getDepositPayoutDetail(t.setDepositPayoutDetail);t.loadDataTable()};t.setUserEvent=function(){s.on("click",".submit",function(n){n.preventDefault();n.stopPropagation();t.loadJobApplicationData(t.setJobApplicationsList)})};h=function(){t.setUserEvent();$.templates.tmplContentJobApplication.link(l,r);t.initDisplayComponent();t.loadJobApplicationData(t.setJobApplicationsList)};h()},pageJobApplications=new PageJobApplications({url:{getJobApplications:"/api/pro/jobapplication/applications",updateJobSeekerApplicationRead:"/api/pro/jobapplication/{{id}}/seeker/read",updateConsultantRead:"/api/pro/consultationinvitation/{{id}}/consultant/read",getPayouRequests:"/api/pro/payoutrequest/jobapplication/{{id}}",getConsultationPayouRequests:"/api/pro/payoutrequest/consultationinvitation/{{id}}",getPayouRequest:"/pro/payoutrequest/{{id}}",getDepositPayoutDetail:"/api/pro/jobApplication/{{id}}/depositPayout",getPayoutInvoiceStatement:"/pro/statement/Pdf/invoice/{{id}}",getServiceChargeInvoiceStatement:"/pro/statement/Pdf/escrow/{{id}}"},msg:{keywordSearch:"search by keyword",info:"this is info"}});