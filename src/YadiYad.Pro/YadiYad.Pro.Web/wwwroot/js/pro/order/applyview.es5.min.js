"use strict";var PageSubscriptionApplyView=function(n){var t=this,u=n.url,i=n.model||{},f;i.selectedPaymentOptionId=null;var e=$.templates("#template-subscription-applyview"),o=$.templates("#template-subscription-payment"),h=$.templates("#template-payment-gateway"),r=$(".content-subscription-applyview"),s=$(".content-payment-gateway");t.loadPaymentOptions=function(n){var t={url:u.getPaymentOptions,method:"GET",headers:{"Content-Type":"application/json"}};$.ajax(t).done(n)};t.generatePaymentLink=function(n){var t={url:u.generatePaymentLink,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({id:i.orderId})};$.ajax(t).done(n)};t.createOrder=function(n){var t,r,f,e,o;typeof pageJobSummary!="undefined"&&(t=pageJobSummary&&pageJobSummary.getModel(),t!==null&&(i.refId=t&&t.selectedJobApplicationId));typeof pageJobCandidate!="undefined"&&(r=pageJobCandidate&&pageJobCandidate.getModel(),r!==null&&(i.refId=r&&r.id));typeof pageJobList!="undefined"&&(f=pageJobList&&pageJobList.getModel(),f!==null&&(i.refId=f&&f.selectedJobApplicationId));e={productTypeId:2,refId:i.refId};o={url:u.createOrder,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};$.ajax(o).done(n)};t.createOrderResponse=function(n){i.orderId=n.data.id;var t=e.render(n.data);r.append(t)};t.paymentService=function(n){var t=i.orderId,r={url:u.updateOrder.format({id:t}),method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({orderStatusId:30,paymentStatusId:30})};$.ajax(r).done(n)};t.responsePaymentService=function(n){t.handleResponse(n,function(){swal({icon:"success",title:"Subscription has been paid"}).then(function(){location.reload()})})};t.setPaymentOptions=function(n){t.handleResponse(n,function(n){var t=o.render({paymentMethods:n.data});r.empty();r.append(t)})};t.redirectToPaymentGateway=function(n){t.handleResponse(n,function(n){s.empty();window.location.href=n.data.paymentURL})};t.handleResponse=function(n,t){n&&n.status&&n.status.code===1?t(n):swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};t.setSelectedPaymentOption=function(n){var t=$(n),u=t.data("id");i.selectedPaymentOptionId=u;r.find(".btn-payment-option").removeClass("border-primary");r.find(".btn-payment-option").addClass("border-white");t.removeClass("border-white");t.addClass("border-primary");r.find(".btn-confirm-pay").removeAttr("disabled")};t.setUserEvent=function(){r.on("click",".btn-pay",function(){t.generatePaymentLink(t.redirectToPaymentGateway)});r.on("click",".btn-payment-option",function(){t.setSelectedPaymentOption(this)});r.on("click",".btn-confirm-pay",function(){t.generatePaymentLink(t.redirectToPaymentGateway)})};f=function(){t.createOrder(t.createOrderResponse);t.setUserEvent()};f()},pageSubscriptionApplyView=new PageSubscriptionApplyView({url:{createOrder:"/api/pro/order/0",updateOrder:"/api/pro/order/{{id}}",getPaymentOptions:"/api/pro/payment/option",generatePaymentLink:"/api/pro/payment"}});