"use strict";var PageServiceSearch=function(n){var i=this,v=n.url,t=n.model||{},k;t.search=null;t.serviceSearchResultList=[];t.selectedCategoryIds=[];t.selectedCategoryNames=[];t.selectedExpertiseIds=[];t.selectedExpertiseNames=[];var w=new SimplePagination(".pagination-service-search-list"),y=$(".content-service-search"),r=y.find(".form-search-filter"),s=r.find('[name="categoryNames"]'),u=r.find('[name="expertiseNames"]'),h=$(".card-category-job-services"),p=y.find(".rdg-category-job-services"),c=$(".card-expertise"),f=y.find(".rdg-expertise"),o=$(".card-service-search-result"),l=$(".pagination-service-search-list"),a=$(".card-service-search-result-empty"),e=o.find(".list-service-search-result"),d=$.templates("#template-rdg-category-job-services"),g=$.templates("#template-rdg-expertise"),b=$.templates("#template-service-profile-simple"),nt=$.templates("#template-service-profile-detail"),tt=(new Date).getTimezoneOffset()/-60;w.onPageChanged=function(n){i.submitServiceSearchRequest(i.setServiceSearchResultList,n)};i.getCategoryJobServices=function(n){var t={url:v.getCategoryJobServices,method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{offset:0,recordSize:9999999}};$.ajax(t).done(n)};i.getExpertise=function(n){var t={url:v.getExpertise,method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{offset:0,recordSize:9999999}};$.ajax(t).done(n)};i.setCategoryJobServices=function(n){var t,i,r;if(n&&n.status&&n.status.code===1)for(t in n.data)i=n.data[t],r=d.render(i),p.append(r)};i.setExpertise=function(n){var t,i,r;if(n&&n.status&&n.status.code===1)for(t in n.data)i=n.data[t],r=g.render(i),f.append(r)};i.submitServiceSearchRequest=function(n,i){var u=app.getFormValue(r),o;u.categoryIds=t.selectedCategoryIds;u.expertiseIds=t.selectedExpertiseIds;var f=10,s=i?i*f:0,e={filter:u.keyword,offset:s,recordSize:f,sorting:null,advancedFilter:u,sortBy:$("#select-service-search-sort").val()};t.search=e;o={url:v.searchService,method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};$.ajax(o).done(n)};i.setServiceSearchResultList=function(n){if(n&&n.status&&n.status.code===1)if(w.set(n.data),n.data.data.length>0){e.empty();$.each(n.data.data,function(t,i){i.tenureStart!==null&&(i.tenureStart=moment(i.tenureStart,"YYYY-MM-DDTHH:mm").add(0,"hour").format("DD MMM YYYY"));i.tenureEnd!==null&&(i.tenureEnd=moment(i.tenureEnd,"YYYY-MM-DDTHH:mm").add(0,"hour").format("DD MMM YYYY"));i.createdOnUTC=moment(i.createdOnUTC,"YYYY-MM-DDTHH:mm").add(tt,"hour").format("DD MMM YYYY");i.index=t+1+n.data.pageIndex*n.data.pageSize});o.bindText({keyword:t.search.filter,totalCount:n.data.totalCount});t.search.offset===0&&i.clearServiceSearchResultList();var r=b.render(n.data.data);e.append(r);t.serviceSearchResultList=t.serviceSearchResultList.concat(n.data.data);o.removeClass("hidden");l.removeClass("hidden");a.addClass("hidden");h.addClass("hidden");c.addClass("hidden")}else a.removeClass("hidden"),o.addClass("hidden"),l.addClass("hidden"),h.addClass("hidden"),c.addClass("hidden");else swal({icon:"warning",title:"Fail",text:n.status.message}).then(function(){})};i.clearServiceSearchResultList=function(){e.empty();t.serviceSearchResultList=[]};i.changeServiceProfileModel=function(n,i){var e=$(n).data("entity-id"),r,u,f;console.log(t);r=$.grep(t.serviceSearchResultList,function(n){return n.id===e});i===0&&(u=b.render(r[0]),$(n).replaceWith(u));i===1&&(f=nt.render(r[0]),$(n).replaceWith(f),t.selectedServiceProfile=r[0])};i.setUserEvent=function(){$("#select-service-search-sort").on("change",function(){$("#select-service-search-sort").val()!=0&&$("#select-service-search-sort").val()!="undefined"&&i.submitServiceSearchRequest(i.setServiceSearchResultList)});r.find("button.btn-search").on("click",function(n){n.preventDefault();n.stopPropagation();r.valid()&&i.submitServiceSearchRequest(i.setServiceSearchResultList)});r.find("button.btn-reset").on("click",function(n){n.preventDefault();n.stopPropagation();app.clearForm(r);app.clearForm(p);t.selectedCategoryIds=[];t.selectedCategoryNames=[];s.val("");s.attr("title","");app.clearForm(f);t.selectedExpertiseIds=[];t.selectedExpertiseNames=[];u.val("");u.attr("title","")});e.on("click",".card-service-profile-simple",function(){e.find(".card-service-profile-detail").each(function(){i.changeServiceProfileModel(this,0)});i.changeServiceProfileModel(this,1)});e.on("click",".card-service-profile-detail",function(n){$(n.target).hasClass("btn-request")===!1&&i.changeServiceProfileModel(this,0)});e.on("click",".btn-subcribe-apply-service",function(){});p.on("change",'[type="checkbox"]',function(){var i=$(this),e=i.val(),h=i.is(":checked"),o=i.closest(".form-check-label").text().trim(),r,u;h?(t.selectedCategoryIds.push(e),t.selectedCategoryNames.push(o)):(t.selectedCategoryIds=$.grep(t.selectedCategoryIds,function(n){return n!==e}),t.selectedCategoryNames=$.grep(t.selectedCategoryNames,function(n){return n!==o}));f.find('[type="checkbox"]').filter(function(){var i=$(this).data("jobservicecategoryid"),n=!t.selectedCategoryIds.some(function(n){return i+""==n+""});return n&&$(this).prop("checked",!1),n}).closest(".container-expertise").hide();r=f.find('[type="checkbox"]').filter(function(){var n=$(this).data("jobservicecategoryid");return t.selectedCategoryIds.some(function(t){return n+""==t+""})}).closest(".container-expertise");r.show();r.length===0&&f.find('[type="checkbox"]').closest(".container-expertise").show();u=t.selectedCategoryNames.join(", ");s.val(u);s.attr("title",u);n()});f.on("change",'[type="checkbox"]',function(){var n=$(this),r=n.val(),e=n.is(":checked"),f=n.closest(".form-check-label").text().trim(),i;e?(t.selectedExpertiseIds.push(r),t.selectedExpertiseNames.push(f)):(t.selectedExpertiseIds=$.grep(t.selectedExpertiseIds,function(n){return n!==r}),t.selectedExpertiseNames=$.grep(t.selectedExpertiseNames,function(n){return n!==f}));i=t.selectedExpertiseNames.join(", ");u.val(i);u.attr("title",i)});var n=function(){t.selectedExpertiseIds=[];t.selectedExpertiseNames=[];f.find('[type="checkbox"]:checked').each(function(){var n=$(this),i=n.val(),r=n.closest(".form-check-label").text().trim();t.selectedExpertiseIds.push(i);t.selectedExpertiseNames.push(r)});var n=t.selectedExpertiseNames.join(", ");u.val(n);u.attr("title",n)};s.on("click",function(){h.removeClass("hidden");a.addClass("hidden");o.addClass("hidden");l.addClass("hidden");c.addClass("hidden")});u.on("click",function(){c.removeClass("hidden");a.addClass("hidden");l.addClass("hidden");o.addClass("hidden");h.addClass("hidden")})};i.getModel=function(){return t};k=function(){i.getCategoryJobServices(i.setCategoryJobServices);i.getExpertise(i.setExpertise);app.initFormComponent(r);i.setUserEvent()};k()},pageServiceSearch=new PageServiceSearch({url:{getCategoryJobServices:"/api/pro/source/jobservicecategory",getExpertise:"/api/pro/source/expertise",searchService:"/api/pro/service/search"}});